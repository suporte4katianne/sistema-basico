<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:p="http://primefaces.org/ui" xmlns:o="http://omnifaces.org/ui"
                template="/WEB-INF/template/Layout.xhtml">


    <ui:define name="content">
        <f:metadata>
            <f:viewAction action="#{notaFiscalFormularioBean.inicializar()}" />
            <o:viewParam name="notaFiscal"
                         value="#{notaFiscalFormularioBean.notaFiscal}"
                         converter="#{notaFiscalConverter}" />
        </f:metadata>

        <h:form id="formNfe">
            <p:tabView id="tabView">
                <p:tab title="Dados do cabeçalho">
                    <p:panel header="Dados do Documento Fiscal de Entrada"
                             id="dadosDocumentoFiscal">

                        <h:panelGrid columns="4" columnClasses="rotulo, campo">

                            <p:outputLabel for="opercao" value="Operação:" />
                            <p:selectOneMenu id="opercao"
                                             value="#{notaFiscalFormularioBean.notaFiscal.operacao}"
                                             required="true">
                                <f:selectItem itemLabel="Selecione..." itemValue="" />
                                <f:selectItem itemLabel="1 - Operação Estadual" itemValue="1" />
                                <f:selectItem itemLabel="2 - Operação Interestadual"
                                              itemValue="2" />
                                <p:ajax process="opercao" update="cfopCabecalho" event="change"
                                        listener="#{notaFiscalFormularioBean.carregaCfopPorTipoEOperacao()}" />
                            </p:selectOneMenu>


                            <p:outputLabel  for="tipoNota" value="Movimentação:" rendered="false" />
                            <p:selectOneMenu id="tipoNota" disabled="true" style="opacity: 0.8"
                                             rendered="false"
                                             value="#{notaFiscalFormularioBean.notaFiscal.tipoNf}"
                                             required="true">
                                <f:selectItem
                                        itemLabel="2 - Compra/Entrada/Devolução de Consumidor"
                                        itemValue="0" />
                                <p:ajax process="tipoNota" update="cfopCabecalho" event="change"
                                        listener="#{notaFiscalFormularioBean.carregaCfopPorTipoEOperacao()}" />
                            </p:selectOneMenu>

                        </h:panelGrid>

                        <h:panelGrid columns="4" columnClasses="rotulo">
                            <p:outputLabel for="cfopCabecalho" value="Natureza Operação:" />
                            <p:selectOneMenu id="cfopCabecalho" converter="#{cfopConverter}" autoWidth="false"
                                             value="#{notaFiscalFormularioBean.notaFiscal.cfop}" required="true">
                                <f:selectItem itemLabel="Selecione..." />
                                <f:selectItems value="#{notaFiscalFormularioBean.cfops}"
                                               var="dados" itemValue="#{dados}"
                                               itemLabel="#{dados.codigo} - #{dados.cfop}" />
                                <p:ajax process="cfopCabecalho" update="cfopProduto"
                                        listener="#{notaFiscalFormularioBean.atualizaCfop()}" />
                            </p:selectOneMenu>

                            <h:outputText value="Emissão: " />
                            <p:selectBooleanCheckbox id="emissao" value="#{notaFiscalFormularioBean.notaFiscal.emissao}" >
                                <p:ajax process="formNfe:tabView:emissao" update="formNfe:tabView:dadosDocumentoFiscal"
                                        listener="#{notaFiscalFormularioBean.emissao()}"/>
                            </p:selectBooleanCheckbox>
                        </h:panelGrid>


                        <h:panelGrid id="numeracao" rendered="#{notaFiscalFormularioBean.emissao().equals('false')}"
                                     columns="6" columnClasses="rotulo, campo">

                            <p:outputLabel for="modelo" value="Modelo:" rendered="#{notaFiscalFormularioBean.alteracao()}" />
                            <p:selectOneMenu id="modelo"
                                             rendered="#{notaFiscalFormularioBean.alteracao()}"
                                             value="#{notaFiscalFormularioBean.notaFiscal.modeloNota}">
                                    <f:selectItem itemValue="01" itemLabel="01 - Nota Fiscal" />
                                    <f:selectItem itemValue="04" itemLabel="04 - Produtor Rural" />
                                    <f:selectItem itemValue="55" itemLabel="55 - Nota Fiscal Eletrônica" />
                                <p:ajax process="modelo" update="serie, numero"
                                        listener="#{notaFiscalFormularioBean.selecionaNumeracao()}" />
                            </p:selectOneMenu>

                            <p:outputLabel for="serie" value="Serie:" />
                            <p:inputText id="serie" style="width: 50px;"
                                         value="#{notaFiscalFormularioBean.notaFiscal.serieNota}" />

                            <p:outputLabel for="numero" value="Número:" />
                            <p:inputText id="numero" style="width: 80px;"
                                         value="#{notaFiscalFormularioBean.notaFiscal.numeroNota}" />

                        </h:panelGrid>
                        <h:panelGrid id="chaveAcesso" rendered="#{notaFiscalFormularioBean.emissao().equals('false')}"
                                     columns="2" columnClasses="rotulo">
                            <p:outputLabel for="chaveDeAcesso" value="Chave de Acesso:" />
                            <p:inputText id="chaveDeAcesso" style="min-width: 472px" value="#{notaFiscalFormularioBean.notaFiscal.chaveAcesso}" />
                        </h:panelGrid>


                        <h:panelGrid id="numeracaoEmissao" rendered="#{notaFiscalFormularioBean.emissao().equals('true')}"
                                     columns="6" columnClasses="rotulo, campo">

                            <p:outputLabel for="modeloEmissao" value="Modelo:" rendered="#{notaFiscalFormularioBean.alteracao()}" />
                            <p:selectOneMenu id="modeloEmissao" converter="#{numeracaoConverter}"
                                             rendered="#{notaFiscalFormularioBean.alteracao()}"
                                             value="#{notaFiscalFormularioBean.numeracao}">
                                <f:selectItems
                                        value="#{notaFiscalFormularioBean.numeracoes}"
                                        var="dados" itemValue="#{dados}" itemLabel="#{dados.modelo}" />
                                <p:ajax process="modelo" update="serie, numero"
                                        listener="#{notaFiscalFormularioBean.selecionaNumeracao()}" />
                            </p:selectOneMenu>

                            <p:outputLabel for="serieEmissao" value="Serie:" />
                            <p:inputText id="serieEmissao" style="opacity:1" disabled="#{notaFiscalFormularioBean.numeracao != null}"
                                         value="#{notaFiscalFormularioBean.notaFiscal.serieNota}" />

                            <p:outputLabel for="numeroEmissao" value="Numero da Nota:" />
                            <p:inputText id="numeroEmissao" style="opacity:1" disabled="#{notaFiscalFormularioBean.numeracao != null}"
                                         value="#{notaFiscalFormularioBean.notaFiscal.numeroNota}" />

                        </h:panelGrid>
                    </p:panel>
                    <div class="ui-fluid">
                        <p:panel header="Dados do Fornecedor" id="dadosFornecedor">
                            <h:panelGrid style="width:90%" columns="4"
                                         columnClasses="rotulo,campo,rotulo ">
                                <p:outputLabel value="Fornecedor" for="fornecedor" />
                                <h:panelGroup style="display:flex;">
                                    <p:inputText
                                            value="#{notaFiscalFormularioBean.notaFiscal.nomeEntidade}"
                                            style="opacity: 1;" id="fornecedor" disabled="true" />
                                    <p:commandButton icon="fa fa-search"
                                                     styleClass="ui-priority-primary" style="max-width: 30px"
                                                     type="button" onclick="PF('fornecedorDialog').show();" />
                                </h:panelGroup>

                                <p:ajaxStatus>
                                    <f:facet name="start">
                                        <i class="fa fa-spinner fa-pulse fa-fw" >Aguarde...</i>
                                    </f:facet>
                                    <f:facet name="complete">
                                        <p:outputLabel value="" />
                                    </f:facet>
                                </p:ajaxStatus>
                                <p:outputLabel value="" />

                                <p:outputLabel value="Tipo do Destintário:"
                                               for="tipoFornecedor" />
                                <p:selectOneMenu id="tipoFornecedor" style="opacity: 1;"
                                                 disabled="true"
                                                 value="#{notaFiscalFormularioBean.notaFiscal.tipoCadastro}">
                                    <f:selectItem itemLabel="Pessoa Fisica" itemValue="2" />
                                    <f:selectItem itemLabel="Pessoa Jurídica" itemValue="1" />
                                    <p:ajax process="tipoFornecedor"
                                            update="cpfCnpj, cpfCnpjLabelFornecedor tipoFornecedor" />
                                </p:selectOneMenu>

                                <p:outputLabel value="" />
                                <p:outputLabel value="" />

                                <p:outputLabel value="Inscrição Estadual:"
                                               for="inscricaoFornecedor" />
                                <p:inputText id="inscricaoFornecedor" style="opacity: 1;"
                                             disabled="true"
                                             value="#{notaFiscalFormularioBean.notaFiscal.inscricaoEstadualEntidade}" />

                                <p:outputLabel id="cpfCnpjLabelFornecedor"
                                               value="#{notaFiscalFormularioBean.notaFiscal.tipoCadastro == '1' ? 'CNPJ:' : 'CPF:'}"
                                               for="cpfCnpj" />
                                <p:inputMask id="cpfCnpj"
                                             mask="#{notaFiscalFormularioBean.notaFiscal.tipoCadastro == '1' ? '99.999.999/9999-99' : '999.999.999-99'}"
                                             value="#{notaFiscalFormularioBean.notaFiscal.cpfCnpjEntidade}"
                                             immediate="true" style="opacity: 1;" disabled="true" />

                                <p:outputLabel value="CEP:" for="cepFornecedor" />
                                <p:inputMask id="cepFornecedor" mask="99999-999"
                                             style="opacity: 1;" disabled="true"
                                             value="#{notaFiscalFormularioBean.notaFiscal.cepEntidade}" />

                                <p:outputLabel value="" />
                                <p:outputLabel value="" />

                                <p:outputLabel value="Estado:" for="estadoFornecedor" />
                                <p:inputText id="estadoFornecedor"
                                             value="#{notaFiscalFormularioBean.notaFiscal.estadoEntidade}"
                                             style="opacity: 1;" disabled="true" />

                                <p:outputLabel value="Cidade:" for="cidadeFornecedor" />
                                <p:inputText id="cidadeFornecedor"
                                             value="#{notaFiscalFormularioBean.notaFiscal.nomeCidadeEntidade}"
                                             style="opacity: 1;" disabled="true" />

                                <p:outputLabel value="Rua:" for="ruaFornecedor" />
                                <p:inputText id="ruaFornecedor" disabled="true"
                                             value="#{notaFiscalFormularioBean.notaFiscal.ruaEntidade}"
                                             style="opacity: 1;" />

                                <p:outputLabel value="Número" for="numeroEnderecoFornecedor" />
                                <p:inputText id="numeroEnderecoFornecedor" style="opacity: 1;"
                                             disabled="true"
                                             value="#{notaFiscalFormularioBean.notaFiscal.numeroEntidade}" />

                                <p:outputLabel value="Bairro:" for="bairroFornecedor" />
                                <p:inputText id="bairroFornecedor" disabled="true"
                                             value="#{notaFiscalFormularioBean.notaFiscal.bairroEntidade}"
                                             style="opacity: 1;" />

                                <p:outputLabel value="Complemento:"
                                               for="complementoFornecedor" />
                                <p:inputText id="complementoFornecedor" style="opacity: 1;"
                                             disabled="true"
                                             value="#{notaFiscalFormularioBean.notaFiscal.complementoEntidade}" />

                                <p:outputLabel value="Telefone:" for="telefoneFornecedor" />
                                <p:inputMask id="telefoneFornecedor" mask="(99) 9999-9999"
                                             style="opacity: 1;" disabled="true"
                                             value="#{notaFiscalFormularioBean.notaFiscal.telefoneEntidade}" />

                            </h:panelGrid>
                            <p:messages globalOnly="false" />
                        </p:panel>
                    </div>
                </p:tab>
                <p:tab title="Produtos">
                    <div class="ui-fluid">
                        <p:panel header="Dados do Produto" id="dadosProduto">
                            <p:messages />
                            <h:panelGrid columns="8" style="width:90%;text-align:right">
                                <p:outputLabel value="Produto:" for="produto" />
                                <h:panelGroup style="display:flex;">
                                    <p:inputText value="#{notaFiscalFormularioBean.notaFiscalItem.produto.descricao}"
                                            style="opacity: 1;" id="produto" disabled="true" />
                                    <p:commandButton icon="fa fa-search"
                                                     styleClass="ui-priority-primary" style="max-width: 30px"
                                                     type="button" onclick="PF('produtoDialog').show();" />
                                </h:panelGroup>

                                <p:outputLabel value="Embalagem:" for="embalagem" />
                                <p:selectOneMenu value="#{notaFiscalFormularioBean.embalagem}" id="embalagem"
                                                 converter="#{embalagemConverter}" >

                                    <f:selectItem itemValue="" itemLabel="#{notaFiscalFormularioBean.notaFiscalItem.produto.unidadeMedida}" />

                                    <f:selectItems value="#{notaFiscalFormularioBean.notaFiscalItem.produto.embalagens}"
                                                   var="embalagem" itemValue="#{embalagem}"
                                                   itemLabel="#{embalagem.unidadeMedida.codigo}(#{embalagem.fatorConversao})" />
                                </p:selectOneMenu>
                                <p:outputLabel value="CFOP: " for="cfopProduto" />
                                <p:selectOneMenu id="cfopProduto" converter="#{cfopConverter}"
                                                 value="#{notaFiscalFormularioBean.notaFiscal.cfop}" required="true">
                                    <f:selectItem itemLabel="Selecione..." />
                                    <f:selectItems value="#{notaFiscalFormularioBean.cfops}"
                                                   var="dados" itemValue="#{dados}"
                                                   itemLabel="#{dados.codigo}" />
                                </p:selectOneMenu>

                                <p:outputLabel value="Quantidade:" for="quantidade" />
                                <p:inputNumber value="#{notaFiscalFormularioBean.notaFiscalItem.quantidade}" id="quantidade"
                                               decimalSeparator="," thousandSeparator="." decimalPlaces="4" />

                                <p:outputLabel value="Valor:" for="valor" />
                                <p:inputNumber value="#{notaFiscalFormularioBean.notaFiscalItem.valorUnitario}" id="valor"
                                               symbol="R$ " decimalSeparator="," thousandSeparator="." decimalPlaces="4" />

                                <p:outputLabel value="Desconto:" for="desconto" />
                                <p:inputNumber value="#{notaFiscalFormularioBean.notaFiscalItem.desconto}" id="desconto"
                                               decimalSeparator="," thousandSeparator="." decimalPlaces="4" />

                                <p:outputLabel value="Total:" for="totalItem" />
                                <p:inputNumber id="totalItem"
                                               decimalSeparator="," thousandSeparator="." decimalPlaces="4" />

                            </h:panelGrid>

                            <br />

                            <p:panel header="Impostos do Produto na Nota" >
                                <h:panelGrid columns="14" style="width:100%" >
                                    <p:outputLabel value="Origem:" for="origem" />
                                    <p:selectOneMenu value="#{notaFiscalFormularioBean.notaFiscalItem.origem}" id="origem" >
                                        <f:selectItems value="#{notaFiscalFormularioBean.origens}" var="origem"
                                                       itemValue="#{origem}" itemLabel="#{origem.codigo}" />
                                    </p:selectOneMenu>
                                    <p:outputLabel value="CST:" for="cst" />
                                    <p:selectOneMenu value="#{notaFiscalFormularioBean.notaFiscalItem.cst}" id="cst" >
                                        <f:selectItems value="#{notaFiscalFormularioBean.csts}" var="CSTICMS"
                                                       itemValue="#{CSTICMS}" itemLabel="#{CSTICMS.codigo}" />
                                    </p:selectOneMenu>
                                    <p:outputLabel value="Red. Base:" for="reducaoBase" />
                                    <p:inputNumber placeholder="%" id="reducaoBase"
                                                   value="#{notaFiscalFormularioBean.notaFiscalItem.reducaoBaseIcms}"
                                                   symbol="% " decimalSeparator="," thousandSeparator="." decimalPlaces="4" />
                                    <p:outputLabel value="BC ICMS:" for="baseIcms" />
                                    <p:inputNumber value="#{notaFiscalFormularioBean.notaFiscalItem.baseIcms}" id="baseIcms"
                                                   placeholder="R$"
                                                   symbol="R$ " decimalSeparator="," thousandSeparator="." decimalPlaces="4" />
                                    <p:outputLabel value="ICMS:" for="icms"/>
                                    <p:inputNumber placeholder="%" id="icms"
                                                   value="#{notaFiscalFormularioBean.notaFiscalItem.icms}"
                                                   symbol="% " decimalSeparator="," thousandSeparator="." decimalPlaces="4" />
                                    <p:outputLabel value="BC ICMS ST:" for="baseIcmsSt" />
                                    <p:inputNumber id="baseIcmsSt" value="#{notaFiscalFormularioBean.notaFiscalItem.baseIcmsSt}"
                                                   placeholder="R$"
                                                   symbol="R$ " decimalSeparator="," thousandSeparator="." decimalPlaces="4" />
                                    <p:outputLabel value="ICMS ST:" for="icmsSt" />
                                    <p:inputNumber placeholder="%" id="icmsSt"
                                                   value="#{notaFiscalFormularioBean.notaFiscalItem.icmsSt}"
                                                   symbol="% " decimalSeparator="," thousandSeparator="." decimalPlaces="4" />
                                </h:panelGrid>

                                <h:panelGrid columns="10" >
                                    <p:outputLabel value="CST IPI:" for="cstIPI"/>
                                    <p:selectOneMenu value="#{notaFiscalFormularioBean.notaFiscalItem.cstIpi}" id="cstIPI" >
                                        <f:selectItems value="#{notaFiscalFormularioBean.cstsIpi}" var="cstIpi"
                                                       itemValue="#{cstIpi}" itemLabel="#{cstIpi.codigo}" />
                                    </p:selectOneMenu>
                                    <p:outputLabel value="% IPI:" for="ipi" />
                                    <p:inputNumber value="#{notaFiscalFormularioBean.notaFiscalItem.aliquotaIpi}" id="ipi"
                                                   placeholder="%" inputStyle="max-width: 80px"
                                                   symbol="% " decimalSeparator="," thousandSeparator="." decimalPlaces="4" />
                                    <p:outputLabel value="CST Pis/Cofins:" for="cstPisCofins"/>
                                    <p:selectOneMenu value="#{notaFiscalFormularioBean.notaFiscalItem.cstPisCofins}" id="cstPisCofins" >
                                        <f:selectItems value="#{notaFiscalFormularioBean.cstsPisCofins}" var="cstPisCofins"
                                                       itemValue="#{cstPisCofins}" itemLabel="#{cstPisCofins.codigo}" />
                                    </p:selectOneMenu>
                                    <p:outputLabel value="% Pis:" for="pis" />
                                    <p:inputNumber id="pis" value="#{notaFiscalFormularioBean.notaFiscalItem.aliquotaPis}"
                                                   placeholder="%" inputStyle="max-width: 80px"
                                                   symbol="% " decimalSeparator="," thousandSeparator="." decimalPlaces="4" />
                                    <p:outputLabel value="% Cofins:" for="cofins" />
                                    <p:inputNumber id="cofins" value="#{notaFiscalFormularioBean.notaFiscalItem.aliquitaCofins}"
                                                   placeholder="%" inputStyle="max-width: 80px"
                                                   symbol="% " decimalSeparator="," thousandSeparator="." decimalPlaces="4" />
                                </h:panelGrid>

                            </p:panel>
                            <h:panelGrid columns="1" style="width:10%">
                                <p:commandButton value="Incluir"
                                                 action="#{notaFiscalFormularioBean.incluirProduto()}"
                                                 styleClass="ui-priority-primary" process="dadosProduto, formNfe:tabView:numero"
                                                 update="dadosProduto, formNfe:tabView:dadosTotais, formNfe:tabView:dadosImpostos" />
                            </h:panelGrid>


                            <p:dataTable emptyMessage="Nenhum item adicionado." reflow="true"
                                         value="#{notaFiscalFormularioBean.notaFiscal.notaFiscalItens}"
                                         var="produtoItem" id="dadosTabelaProduto"
                                         rowKey="produtoItem.codProd">

                                <p:column headerText="Cód" style="width:10%">
                                    <h:outputText value="#{produtoItem.codProd}" />
                                </p:column>

                                <p:column headerText="Nome" style="width:60%">
                                    <h:outputText value="#{produtoItem.nomeProduto}" />
                                </p:column>

                                <p:column headerText="Qtd" style="width:10%">
                                    <h:outputText value="#{produtoItem.quantidade}" />
                                </p:column>

                                <p:column headerText="Vlr" style="width:10%">
                                    <h:outputText value="#{produtoItem.valorUnitario}" />
                                </p:column>

                                <p:column headerText="Desc" style="width:10%">
                                    <h:outputText value="#{produtoItem.desconto}" />
                                </p:column>

                                <p:column headerText="Total" style="width:13%">
                                    <h:outputText value="#{produtoItem.valorTotal}" />
                                </p:column>

                                <p:column headerText="CST" style="width:10%">
                                    <h:outputText value="#{produtoItem.cst.codigo}" />
                                </p:column>

                                <p:column headerText="Pis" style="width:13%">
                                    <h:outputText value="#{produtoItem.cstPisCofins.codigo}" />
                                </p:column>

                                <p:column headerText="CFOP" style="width:10%">
                                    <h:outputText value="#{produtoItem.cfop}" />
                                </p:column>

                                <p:column headerText="..." style="width:10%">
                                    <p:commandButton icon="fa fa-trash-o"
                                                     styleClass="ui-priority-primary"
                                                     actionListener="#{notaFiscalFormularioBean.removerProduto(produtoItem)}"
                                                     update="dadosTabelaProduto, formNfe:tabView:dadosImpostos, formNfe:tabView:dadosTotais"/>
                                    <p:commandButton icon="fa fa-pencil"
                                                     styleClass="ui-priority-primary"
                                                     actionListener="#{notaFiscalFormularioBean.editarProduto(produtoItem)}"
                                                     update="dadosTabelaProduto, formNfe:tabView:dadosImpostos, formNfe:tabView:dadosProduto, formNfe:tabView:dadosTotais" />
                                </p:column>

                                <f:facet name="footer">
                                    <div align="left"/>
                                </f:facet>

                            </p:dataTable>
                        </p:panel>
                    </div>
                </p:tab>
                <p:tab title="Transportadora">
                    <div class="ui-fluid">
                        <p:panel header="Dados da Transportadora" id="dadosTransportadora">
                            <p:messages />
                            <h:panelGrid columns="4" style="width: 90%"
                                         columnClasses="rotulo,campo,rotulo">
                                <p:outputLabel value="Tipo do Frete:" for="tipoFrete" />
                                <p:selectOneMenu id="tipoFrete"
                                                 value="#{notaFiscalFormularioBean.notaFiscal.modeloFrete}">
                                    <f:selectItem itemValue="0" itemLabel="0-Por conta do empresa" />
                                    <f:selectItem itemValue="1"
                                                  itemLabel="1-Por conta do destinatário" />
                                    <f:selectItem itemValue="2"
                                                  itemLabel="2-Por conta de terceiros" />
                                    <f:selectItem itemValue="9" itemLabel="9-Sem frete" />
                                </p:selectOneMenu>

                                <p:outputLabel value="" />
                                <p:outputLabel value="" />

                                <p:outputLabel value="Transportadora:" for="nomeTransportadora" />
                                <h:panelGroup style="display:flex;">
                                    <p:inputText
                                            value="#{notaFiscalFormularioBean.notaFiscal.nomeTransportadora}"
                                            style="opacity: 1;" id="nomeTransportadora" disabled="true" />
                                    <p:commandButton icon="fa fa-search"
                                                     styleClass="ui-priority-primary" style="max-width: 30px"
                                                     type="button" onclick="PF('transportadoraDialog').show();" />
                                </h:panelGroup>

                                <p:outputLabel value="" />
                                <p:outputLabel value="" />

                                <p:outputLabel id="cpfCnpjLabelTransportadora"
                                               value="#{notaFiscalFormularioBean.notaFiscal.tipoCadastroTransportadora == '1' ? 'CNPJ:' : 'CPF:'}"
                                               for="cpfCnpjTransportadora" />
                                <p:inputMask id="cpfCnpjTransportadora"
                                             mask="#{notaFiscalFormularioBean.notaFiscal.tipoCadastroTransportadora == '1' ? '99.999.999/9999-99' : '999.999.999-99'}"
                                             value="#{notaFiscalFormularioBean.notaFiscal.cpfCnpjTransportadora}"
                                             immediate="true" style="opacity: 1;" disabled="true" />

                                <p:outputLabel value="Inscrição Estadual:" for="ie" />
                                <p:inputText id="ie"
                                             value="#{notaFiscalFormularioBean.notaFiscal.inscricaoEstadualTransportadora}" />

                                <p:outputLabel value="Estado:" for="estadoTransportadora" />
                                <p:inputText id="estadoTransportadora"
                                             value="#{notaFiscalFormularioBean.notaFiscal.estadoTransportadora}" />

                                <p:outputLabel value="Cidade:" for="cidadeTransportadora" />
                                <p:inputText id="cidadeTransportadora"
                                             value="#{notaFiscalFormularioBean.notaFiscal.cidadeTransportadora}" />

                                <p:outputLabel value="Endereço:" for="enderecoTransportadora" />
                                <p:inputText id="enderecoTransportadora"
                                             value="#{notaFiscalFormularioBean.notaFiscal.enderecoTransportadora}" />
                            </h:panelGrid>
                        </p:panel>
                    </div>
                </p:tab>
                <p:tab title="Subtotal">
                    <p:panel header="Impostos" id="dadosImpostos" >
                        <h:panelGrid columns="6"
                                     columnClasses="rotulo, campoNfe, rotulo, campoNfe, rotulo, campoNfe"
                                     layout="grid" style="width: 100%; ">
                            <p:outputLabel value="ICMS:" for="vIcms" />
                            <p:inputNumber id="vIcms" disabled="true"
                                           value="#{notaFiscalFormularioBean.notaFiscal.valorTotalIcms}"
                                           symbol="R$ " decimalSeparator="," thousandSeparator="."
                                           decimalPlaces="2" />

                            <p:outputLabel value="Base ICMS:" for="bIcms" />
                            <p:inputNumber id="bIcms" disabled="true"
                                           value="#{notaFiscalFormularioBean.notaFiscal.valorTotalBaseIcms}"
                                           symbol="R$ " decimalSeparator="," thousandSeparator="."
                                           decimalPlaces="2" />

                            <p:outputLabel value="ICMS ST:" for="vIcmsSt" />
                            <p:inputNumber id="vIcmsSt" disabled="true"
                                           value="#{notaFiscalFormularioBean.notaFiscal.valorTotalIcmsS}"
                                           symbol="R$ " decimalSeparator="," thousandSeparator="."
                                           decimalPlaces="2" />

                            <p:outputLabel value="Base ICMS ST:" for="bIcmsSt" />
                            <p:inputNumber id="bIcmsSt" disabled="true"
                                           value="#{notaFiscalFormularioBean.notaFiscal.valorTotalBaseIcmsSt}"
                                           symbol="R$ " decimalSeparator="," thousandSeparator="."
                                           decimalPlaces="2" />

                            <p:outputLabel value="Valor PIS:" for="vPis" />
                            <p:inputNumber id="vPis" disabled="true"
                                           value="#{notaFiscalFormularioBean.notaFiscal.valorTotalPis}"
                                           symbol="R$ " decimalSeparator="," thousandSeparator="."
                                           decimalPlaces="2" />

                            <p:outputLabel value="Valor Cofins:" for="vCofins" />
                            <p:inputNumber id="vCofins" disabled="true"
                                           value="#{notaFiscalFormularioBean.notaFiscal.valorTotalCofins}"
                                           symbol="R$ " decimalSeparator="," thousandSeparator="."
                                           decimalPlaces="2" />

                            <p:outputLabel value="Valor IPI:" for="vIpi" />
                            <p:inputNumber id="vIpi" disabled="true"
                                           value="#{notaFiscalFormularioBean.notaFiscal.valorTotalIpi}"
                                           symbol="R$ " decimalSeparator="," thousandSeparator="."
                                           decimalPlaces="2" />

                            <p:outputLabel value="Funrural:" for="funrural" />
                            <p:inputNumber id="funrural" disabled="true" value="0"
                                           symbol="R$ " decimalSeparator="," thousandSeparator="."
                                           decimalPlaces="2" />

                            <p:outputLabel value="Valor de Tributos (Aproximados):"
                                           for="tribAprox" />
                            <p:inputNumber id="tribAprox" disabled="true"
                                           value="#{notaFiscalFormularioBean.notaFiscal.valorTotalImpostosAproximados}"
                                           symbol="R$ " decimalSeparator="," thousandSeparator="."
                                           decimalPlaces="2" />
                        </h:panelGrid>
                    </p:panel>
                    <p:panel header="Totais" id="dadosTotais">
                        <h:panelGrid columns="6"
                                     columnClasses="rotulo, campoNfe, rotulo, campoNfe, rotulo, campoNfe"
                                     layout="grid" style="width: 100%; ">
                            <p:outputLabel value="Total dos Produtos:" for="vTotalProduto" />
                            <p:inputNumber id="vTotalProduto" disabled="true"
                                           value="#{notaFiscalFormularioBean.notaFiscal.valorTotalProdutos}"
                                           symbol="R$ " decimalSeparator="," thousandSeparator="."
                                           decimalPlaces="2" />

                            <p:outputLabel value="Total da Nota Fiscal:"
                                           for="vTotalNotaFiscal" />
                            <p:inputNumber id="vTotalNotaFiscal" disabled="true"
                                           value="#{notaFiscalFormularioBean.notaFiscal.valorTotalNfe}"
                                           symbol="R$ " decimalSeparator="," thousandSeparator="."
                                           decimalPlaces="2" />

                            <p:outputLabel value="Total de Descontos:" for="vTotalDesconto" />
                            <p:inputNumber id="vTotalDesconto" disabled="true"
                                           value="#{notaFiscalFormularioBean.notaFiscal.valorTotalDesconto}"
                                           symbol="R$ " decimalSeparator="," thousandSeparator="."
                                           decimalPlaces="2" />
                        </h:panelGrid>
                    </p:panel>
                </p:tab>
                <p:tab title="Dados adicionais">
                    <p:panel header="Informações Complementares">
                        <div class="ui-fluid">
                            <p:inputTextarea id="ifoComplementar" rows="8" autoResize="true"
                                             value="#{notaFiscalFormularioBean.notaFiscal.informacoesComplementare}" />
                        </div>
                    </p:panel>
                    <p:panel id="documentosReferenciados"
                             header="Documentos Referenciados">
                        <h:panelGrid columns="2" columnClasses="rotulo">
                            <p:outputLabel value="Tipo de Documento:" />
                            <p:selectOneMenu id="tipoDocumentoReferenciado"
                                             style="width: 616px"
                                             value="#{notaFiscalFormularioBean.notaFiscalReferencia.tipoDocumento}">
                                <f:selectItem itemLabel="Selecione..." />
                                <f:selectItem itemLabel="Cupom Fiscal" itemValue="0" />
                                <f:selectItem itemLabel="Nota Fiscal" itemValue="1" />
                                <p:ajax update="formNfe:tabView:documentosReferenciados" process="formNfe:tabView:tipoDocumentoReferenciado"
                                        listener="#{notaFiscalFormularioBean.limpaNotaFiscalReferencias()}" />
                            </p:selectOneMenu>
                        </h:panelGrid>

                        <h:panelGrid id="cupomFiscalReferencia" columns="6"
                                     columnClasses="rotulo"
                                     rendered="#{notaFiscalFormularioBean.notaFiscalReferencia.tipoDocumento.equals('0') }">

                            <p:outputLabel for="cooReferencia" value="COO:" />
                            <p:inputText id="cooReferencia"
                                         value="#{notaFiscalFormularioBean.notaFiscalReferencia.coo}" />

                            <p:outputLabel for="pdvReferencia" value="PDV" />
                            <p:inputText id="pdvReferencia"
                                         value="#{notaFiscalFormularioBean.notaFiscalReferencia.pdv}" />

                            <p:outputLabel for="dataReferencia_1" value="Data:" />
                            <p:calendar id="dataReferencia_1" locale="pt_BR"
                                        pattern="dd/MM/yyyy"
                                        value="#{notaFiscalFormularioBean.notaFiscalReferencia.data}" />

                            <p:outputLabel for="serieEcfReferencia" value="Série ECF:" />
                            <p:inputText id="serieEcfReferencia" style="width: 390px;"
                                         value="#{notaFiscalFormularioBean.notaFiscalReferencia.ecfSerie}" />

                            <p:outputLabel value="" />
                            <p:outputLabel value="" />
                            <p:outputLabel value="" />
                            <p:outputLabel value="" />
                            <p:outputLabel value="" />

                            <p:commandButton styleClass="ui-priority-primary"
                                             value="Incluir documento referenciado"
                                             actionListener="#{notaFiscalFormularioBean.incluirNotaFiscalReferenciaCupom()}"
                                             process="documentosReferenciados"
                                             update="documentosReferenciados" />
                        </h:panelGrid>


                        <p:dataTable
                                rendered="#{notaFiscalFormularioBean.notaFiscalReferencia.tipoDocumento.equals('0')}"
                                value="#{notaFiscalFormularioBean.notaFiscal.notaFiscalReferencias}"
                                emptyMessage="Nenhum item adicionado." reflow="true" var="dados"
                                style="margin-top: 15px" id="tabelaDocumentoReferenciadoChave"
                                rowKey="#{dados.coo}">

                            <p:column headerText="COO" style="width:20%">
                                <h:outputText value="#{dados.coo}" />
                            </p:column>

                            <p:column headerText="PDV" style="width:20%">
                                <h:outputText value="#{dados.pdv}" />
                            </p:column>

                            <p:column headerText="Data" style="width:10%">
                                <p:outputLabel value="#{dados.data}">
                                    <f:convertDateTime pattern="dd/MM/yyyy" />
                                </p:outputLabel>
                            </p:column>

                            <p:column headerText="Série ECF" style="width:30%">
                                <h:outputText value="#{dados.ecfSerie}" />
                            </p:column>

                            <p:column headerText="Ações" style="width:5%">
                                <p:commandButton
                                        actionListener="#{notaFiscalFormularioBean.editarNotaFiscalReferencia(dados)}"
                                        update="formNfe:tabView:documentosReferenciados"
                                        process="formNfe:tabView:documentosReferenciados"
                                        icon="fa fa-edit" />
                                <p:commandButton
                                        actionListener="#{notaFiscalFormularioBean.removerNotaFiscalReferencia(dados)}"
                                        update="formNfe:tabView:documentosReferenciados"
                                        process="formNfe:tabView:documentosReferenciados"
                                        icon="ui-icon-trash" />
                            </p:column>
                        </p:dataTable>

                        <h:panelGrid id="documentoEletronicoReferencia" columns="2"
                                     columnClasses="rotulo"
                                     rendered="#{notaFiscalFormularioBean.notaFiscalReferencia.tipoDocumento.equals('1')}">
                            <p:outputLabel for="numeroReferencia" value="Chave:" />
                            <p:inputText id="numeroReferencia" style="width: 450px;"
                                         value="#{notaFiscalFormularioBean.notaFiscalReferencia.chave}" />
                            <p:outputLabel value="" />
                            <p:commandButton styleClass="ui-priority-primary"
                                             value="Incluir documento referenciado"
                                             actionListener="#{notaFiscalFormularioBean.incluirNotaFiscalReferenciaNota()}"
                                             process="documentosReferenciados"
                                             update="documentosReferenciados" />
                        </h:panelGrid>

                        <p:dataTable
                                rendered="#{notaFiscalFormularioBean.notaFiscalReferencia.tipoDocumento.equals('1')}"
                                value="#{notaFiscalFormularioBean.notaFiscal.notaFiscalReferencias}"
                                emptyMessage="Nenhum item adicionado." reflow="true" var="dados"
                                style="margin-top: 15px" id="tabelaDocumentoReferenciadoNota"
                                rowKey="#{dados.chave}">

                            <p:column headerText="Chave" style="width:20%">
                                <h:outputText value="#{dados.chave}" />
                            </p:column>

                            <p:column headerText="Ações" style="width:5%">
                                <p:commandButton
                                        actionListener="#{notaFiscalFormularioBean.editarNotaFiscalReferencia(dados)}"
                                        update="formNfe:tabView:documentosReferenciados"
                                        process="formNfe:tabView:documentosReferenciados"
                                        icon="fa fa-edit" />
                                <p:commandButton
                                        actionListener="#{notaFiscalFormularioBean.removerNotaFiscalReferencia(dados)}"
                                        update="formNfe:tabView:documentosReferenciados"
                                        process="formNfe:tabView:documentosReferenciados"
                                        icon="ui-icon-trash" />
                            </p:column>
                        </p:dataTable>
                    </p:panel>
                </p:tab>
            </p:tabView>

            <p:toolbar>
                <f:facet name="left">
                    <p:commandButton styleClass="ui-priority-primary" process="@form"
                                     style="margin-top: 3px; margin-bottom: 3px; margin-left: 7px"
                                     value="Salvar" icon="fa fa-floppy-o" action="#{notaFiscalFormularioBean.salvar()}"
                                     onclick="PF('salvarCadastro').disable();" widgetVar="salvarCadastro" />
                </f:facet>
                <f:facet name="right">
                    <p:button outcome="Entrada" value="Cancelar" icon="fa fa-reply" styleClass="ui-priority-primary"
                              style="margin-top: 3px; margin-bottom: 3px; margin-left: -7px" />
                </f:facet>
            </p:toolbar>
        </h:form>


        <p:dialog widgetVar="fornecedorDialog" modal="true" height="400" header="Pesquisa de Fornecedores"
                  width="700" resizable="false">
            <h:form>
                <p:dataTable value="#{notaFiscalFormularioBean.entidades}"
                             widgetVar="listaFornecedors" selectionMode="single"
                             emptyMessage="Nenhum item adicionado" reflow="true" var="dados"
                             id="dadosFornecedorTabela" multiViewState="true" rowKey="#{dados.id}"
                             selection="#{notaFiscalFormularioBean.notaFiscal.entidade}"
                             filteredValue="#{notaFiscalFormularioBean.entidadesFiltro}"
                             rows="10">

                    <f:facet name="header">
                        <div align="left">
                            <p:outputPanel style="align:left">
                                <p:outputLabel value="Pesquisar: " for="globalFilter" />
                                <p:inputText id="globalFilter"
                                             onkeyup="PF('listaFornecedors').filter()" />
                                <p:commandButton icon="fa fa-refresh" style="float:right" update="dadosFornecedorTabela"
                                                 actionListener="#{notaFiscalFormularioBean.refreshEntidade()}" process="@this"
                                                 styleClass="ui-priority-primary" />
                            </p:outputPanel>
                        </div>
                    </f:facet>

                    <p:ajax event="rowSelect" process="dadosFornecedorTabela"
                            update="dadosFornecedorTabela" />
                    <p:ajax event="rowDblselect" listener="#{notaFiscalFormularioBean.carregaDadosDaEntidade()}"
                            process="dadosFornecedorTabela"
                            oncomplete="PF('fornecedorDialog').hide()"
                            update="formNfe:tabView:dadosFornecedor" />

                    <p:column headerText="Nome" filterBy="#{dados.nome}"
                              filterStyle="display:none">
                        <h:outputText value="#{dados.nome}" />
                    </p:column>

                    <f:facet name="footer">
                        <div align="left">
                            <p:commandButton value="Selecionar" styleClass="ui-priority-primary"
                                             action="#{notaFiscalFormularioBean.carregaDadosDaEntidade()}"
                                             oncomplete="PF('fornecedorDialog').hide()"
                                             update="formNfe:tabView:dadosFornecedor" />
                        </div>
                    </f:facet>

                </p:dataTable>
            </h:form>
        </p:dialog>

        <p:dialog widgetVar="produtoDialog" modal="true" height="400" header="Pesquisa de Produto"
                  width="700" resizable="false">
            <h:form>
                <p:dataTable value="#{notaFiscalFormularioBean.produtos}"
                             widgetVar="listaProdutos" selectionMode="single"
                             emptyMessage="Nenhum item adicionado" reflow="true" var="dados"
                             id="dadosProdutoTabela" multiViewState="true" rowKey="#{dados.id}"
                             selection="#{notaFiscalFormularioBean.notaFiscalItem.produto}"
                             filteredValue="#{notaFiscalFormularioBean.produtosFiltro}"
                             rows="10">

                    <f:facet name="header">
                        <div align="left">
                            <p:outputPanel style="aling:left">
                                <p:outputLabel value="Pesquisar: " for="globalFilter" />
                                <p:inputText id="globalFilter"
                                             onkeyup="PF('listaProdutos').filter()" />
                                <p:commandButton icon="fa fa-refresh" style="float:right" update="dadosProdutoTabela"
                                                 actionListener="#{notaFiscalFormularioBean.refreshProduto()}" process="@this"
                                                 styleClass="ui-priority-primary" />
                            </p:outputPanel>
                        </div>
                    </f:facet>

                    <p:ajax event="rowSelect" process="dadosProdutoTabela"
                            update="dadosProdutoTabela" />
                    <p:ajax event="rowDblselect" listener="#{notaFiscalFormularioBean.carregaDadosDoProdutoEntrada()}"
                            process="dadosProdutoTabela"
                            oncomplete="PF('produtoDialog').hide()"
                            update="formNfe:tabView:dadosProduto" />

                    <p:column headerText="Nome" filterBy="#{dados.descricao}"
                              filterStyle="display:none">
                        <h:outputText value="#{dados.descricao}" />
                    </p:column>

                    <f:facet name="footer">
                        <div align="left">
                            <p:commandButton value="Selecionar"
                                             styleClass="ui-priority-primary"
                                             action="#{notaFiscalFormularioBean.carregaDadosDoProdutoEntrada()}"
                                             oncomplete="PF('produtoDialog').hide()"
                                             update="formNfe:tabView:dadosProduto" />
                        </div>
                    </f:facet>
                </p:dataTable>
            </h:form>
        </p:dialog>


        <p:dialog widgetVar="transportadoraDialog" modal="true" height="700" header="Pesquisa de Transportadoras"
                  width="700" resizable="false">
            <h:form>
                <p:dataTable value="#{notaFiscalFormularioBean.transportadoras}"
                             widgetVar="listaTransportadoras" selectionMode="single"
                             emptyMessage="Nenhum item adicionado" reflow="true" var="dados"
                             id="dadosTabela" multiViewState="true" rowKey="#{dados.id}"
                             selection="#{notaFiscalFormularioBean.notaFiscal.transportadora}"
                             filteredValue="#{notaFiscalFormularioBean.transportadorasFiltro}"
                             rows="10">

                    <f:facet name="header">
                        <div align="left">
                            <p:outputPanel style="aling:left">
                                <p:outputLabel value="Pesquisar: " for="globalFilter" />
                                <p:inputText id="globalFilter"
                                             onkeyup="PF('listaTransportadoras').filter()" />
                                <p:commandButton icon="fa fa-refresh" style="float:right" update="dadosTabela"
                                                 actionListener="#{notaFiscalFormularioBean.refreshTransportadora()}"
                                                 process="@this"
                                                 styleClass="ui-priority-primary" />
                            </p:outputPanel>
                        </div>
                    </f:facet>

                    <p:ajax event="rowSelect" process="dadosTabela"
                            update="dadosTabela" />
                    <p:ajax event="rowDblselect" listener="#{notaFiscalFormularioBean.carregaDadosDaTransportadora()}"
                            process="dadosTabela"
                            oncomplete="PF('transportadoraDialog').hide()"
                            update="formNfe:tabView:dadosTransportadora" />

                    <p:column headerText="Nome" filterBy="#{dados.nome}"
                              filterStyle="display:none">
                        <h:outputText value="#{dados.nome}" />
                    </p:column>

                    <f:facet name="footer">
                        <div align="left">
                            <p:commandButton value="Selecionar"
                                             styleClass="ui-priority-primary"
                                             action="#{notaFiscalFormularioBean.carregaDadosDaTransportadora()}"
                                             oncomplete="PF('transportadoraDialog').hide()"
                                             update="formNfe:tabView:dadosTransportadora" />
                        </div>
                    </f:facet>
                </p:dataTable>
            </h:form>
        </p:dialog>


    </ui:define>

</ui:composition>